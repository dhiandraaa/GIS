<!DOCTYPE html>
<html>
<style>
	#map {
    height: 300px;
    width: 90%;
}
</style>
  <head>
  <title>Sitepu</title>
  <link href="index.css" rel="stylesheet" type="text/css">
  </head>
<body><center><div id="wrap">
  	<div id=header>
		<h2>SITEPU</h2>
	</div>
    	<div id="map"></div><br>
		<div id=info>
    		<input type="text" name="lng" placeholder="Longitude"> &nbsp;
    		<input type="text" name="lat" placeholder="Latitude"><br><br>
			<textarea name="tempat"></textarea>
    	</div>
		<button type="button" id="save">Save</button>
    </div>
	</center>
</body>
		
		<script src="https://www.gstatic.com/firebasejs/4.11.0/firebase.js"></script>
		<script>
  // Initialize Firebase
	var config = {
		apiKey: "AIzaSyDEQFNTDHoltRvu-wrdhGQxzpgUFzMo1bM",
		authDomain: "tugas-sig-1521500286405.firebaseapp.com",
		databaseURL: "https://tugas-sig-1521500286405.firebaseio.com",
		projectId: "tugas-sig-1521500286405",
		storageBucket: "",
		messagingSenderId: "358420723994"
	};
	firebase.initializeApp(config);

	var db              = firebase.database();
	var dataRef         = db.ref('Sitepu');
	var newPolygon      = null;
	var arrayPolygon    = [];
	var map             = null;
	var coords          = [];
	var markers         = [];
	var center          = {lat: -5.400549,lng: 105.266272};

	dataRef.on('value', updateInfo, showErr);

        function initMap(){
			
		var map = new google.maps.Map(document.getElementById('map'), {
			zoom: 11,
			center:center
		});

		map.addListener('click', function (e) {
			var latLng = e.latLng;
			coords.push({lat: latLng.lat(), lng: latLng.lng()});
			markers.push(createMarker({lat: latLng.lat(), lng: latLng.lng()}));
		});

		  var infoWin = new google.maps.InfoWindow();
            console.log(map);
        
            var markers = locations.map(function(location, i) {
                var marker = new google.maps.Marker({
                    position: location,
		icon : 'images/pin.png',
		animation: google.maps.Animation.BOUNCE
					});
					google.maps.event.addListener(marker, 'dblclick', function(evt) {
						infoWin.setContent(location.info);
						infoWin.open(map, marker);
					})

				return marker;
                }); 
            console.log(locations);
            console.log(markers);
            var markerCluster = new MarkerClusterer(map, markers,
                {imagePath: 'images/m'});
        
            var d = markerCluster.distanceBetweenPoints_(markers[2].getPosition(),markers[4].getPosition());
            console.log(markerCluster.getCalculator());
		}
//
		dataRef.on('value', updateInfo, showErr);
		function updateInfo(data){
			console.log("berhasil");
		}
		function showErr(err){
			console.log(err);
		}
		var coords=[
					   // {lat:4,lng:20},
					   // {lat:11,lng:14},
					   // {lat:3,lng:1}
					];
		var lines = {points:coords};

		function createMarker(coord){
			var marker = new google.maps.Marker(
				{
					position:coord,
					map: map
				}
			);
			return marker;
		}
		document.getElementById("save").addEventListener("click",function(){
			var lines = {points:coords};
			arrayPolygon.forEach(function(data){
				data.setMap(null);
			});
			dataRef.push(
				{
					tupe :'polyline',
					geometry : lines
				}
			);
			coords=[];
		});

		function createPolygon(coord){
			var tempPoly = new google.maps.Polygon({
			Path : coord,
			strokeColor :'red',
			strokeOpocity : 0.8,
			strokeWeight : 1,
			fillColor : 'red',
			fillOpocity : 0.35
		});
		tempPoly.setMap(map);
		return tempPoly;
		}

		function showErr(err){
			console.log(err);
		}
		function updateInfo(data){
			data.forEach(function(datamarker){
				arrayPolygon.push(createPolygon(datamarker.val().geometry.points));
			});
		}
//

        var locations = [
			{lat: -5.397317, lng: 105.262002, info: "Makam Pahlawan"},
			{lat: -5.363868, lng: 105.248657, info: "Kampung Baru"},
			{lat: -5.372858, lng: 105.239979, info: "KB. Anak Agung Siwo Mego"},
			{lat: -5.378445, lng: 105.240977, info: "Muslim Kamboja"},
			{lat: -5.377909, lng: 105.244274, info: "Jl. Sultan Jamil"},
			{lat: -5.427119, lng: 105.268171, info: "KB Payakun"},
			{lat: -5.413963, lng: 105.261228, info: "Kebon Jahe"},
			{lat: -5.415326, lng: 105.272232, info: "Klutum"},
			]
    </script>	
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDbqwfq4FJ6xxI_Oho85sA-2jlWUZLI5gM&callback=initMap"
	type="text/javascript"></script>
	<script src="src/markerclusterer.js">
    </script>
	
</html>
